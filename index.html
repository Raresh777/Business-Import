
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input[type="file"] {
            margin-top: 20px;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>CSV Address Formatter</h1>
    <input type="file" id="csvFile" accept=".csv">
    <button id="processBtn">Process CSV</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
            return data.map((row, index) => {
                if (index === 0) {
                    return ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link'];
                }

                const directoryLink = row[3]; // Column D
                const businessName = row[7]; // Column H
                const category1 = 'Shop Local'; 
                const subCategory1 = 'Essential Business';
                const about = row[11]; // Column L
                const fullAddress = row[12]; // Column M
                let [address, city, state, zip] = ['', '', '', ''];
                let addressLine2 = '';
                if(fullAddress) {
                    let parts = fullAddress.split(',');
                    address = parts[0].trim();
                    if (parts.length > 3) {
                        addressLine2 = parts[1].trim();
                        city = parts[2].trim();
                    } else if (parts.length > 2) {
                        city = parts[1].trim();
                    }
                    state = parts[parts.length - 2].trim();
                    zip = parts[parts.length - 1].trim();
                }
                let phone = row[6].replace(/[\s-]/g, ''); // Column G
                const country = 'US';
                const email = row[9]; // Column J
                const website = '';
                const instagram = '';
                const facebook = '';
                const twitter = '';
                const youtube = '';

                return [directoryLink, businessName, category1, subCategory1, about, address, addressLine2, city, state, zip, phone, country, email, website, instagram, facebook, twitter, youtube];
            });
        }

        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement("a");
            var url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "corrected_addresses.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
