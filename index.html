<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2, #6e45e2, #88d3ce);
            color: white;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        h1 {
            text-align: center;
            color: #fff;
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background: linear-gradient(to right, #6e45e2, #88d3ce);
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        button:hover {
            background: linear-gradient(to right, #88d3ce, #6e45e2);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV Address Formatter</h1>
        <input type="file" id="csvFile" accept=".csv">
        <button id="processBtn">Process CSV</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
    return data.map((row, index) => {
        if (index === 0) {
            // Skip the header row
            return row;
        }

        // Initialize the corrected address fields
        let address = '';
        let addressLine2 = '';
        let city = '';
        let state = '';
        let zip = '';

        // Process the full address from column M
        const fullAddressParts = row['M'].split(',').map(part => part.trim());

        // Detect and assign the street address, city, state, and zip
        address = fullAddressParts[0]; // Street address is typically the first part
        if (fullAddressParts.length > 1) {
            // The last two parts are usually state and zip
            state = fullAddressParts[fullAddressParts.length - 2];
            zip = fullAddressParts[fullAddressParts.length - 1];

            // Check if the second part is a suite/office number or a city
            if (fullAddressParts[1].toLowerCase().includes('suite') || fullAddressParts[1].toLowerCase().includes('office')) {
                addressLine2 = fullAddressParts[1];
                // If there's an address line 2, the city would be in the third part
                if (fullAddressParts.length > 2) {
                    city = fullAddressParts[2];
                }
            } else {
                // If no suite/office number, the second part is the city
                city = fullAddressParts[1];
            }
        }

        // Remove any web links from the address fields
        [address, addressLine2, city, state, zip].forEach(field => {
            if (field && field.match(/http[s]?:\/\//)) {
                field = ''; // Clear the field if it contains a web link
            }
        });

        // Format the phone number, removing any non-digit characters
        const phone = row['G'].replace(/\D/g, '');

        // Construct the corrected row with the processed data
        let correctedRow = {
            'Directory Link': row['D'],
            'Business Name': row['H'],
            'Category 1': 'Shop Local',
            'Sub category 1': 'Essential Business',
            'About': row['L'],
            'Address': address,
            'Address line 2': addressLine2,
            'City': city,
            'State': state,
            'Zip': zip,
            'Phone': phone,
            'Country': 'US',
            'Email': row['J'],
            'Website': '',
            'Instagram username': '',
            'Facebook username': '',
            'Twitter username': '',
            'YouTube video link': ''
        };

        return correctedRow;
    });
}
        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            var url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'corrected_addresses.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
