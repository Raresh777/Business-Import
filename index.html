<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: url('URL_OF_YOUR_MECHANICAL_BACKGROUND_IMAGE') no-repeat center center fixed;
            background-size: cover;
            color: white;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: rgba(0, 0, 0, 0.75);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            width: 40%;
            min-width: 300px;
        }
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 20px;
            font-weight: 300;
        }
        input[type="file"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            border: 2px solid #555;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }
        button {
            display: block;
            width: calc(100% - 20px);
            padding: 10px;
            margin-top: 20px;
            background: linear-gradient(45deg, #9c27b0, #ff9800);
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            outline: none;
        }
        button:hover, button:focus {
            background: linear-gradient(45deg, #ff9800, #9c27b0);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV Address Formatter</h1>
        <input type="file" id="csvFile" accept=".csv">
        <button id="processBtn">Process CSV</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
    return data.map((row, index) => {
        // Skip the header row and return the headers for the corrected CSV
        if (index === 0) {
            return ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link'];
        }

        // Initialize corrected row with static and simple transformation values
        let correctedRow = {
            'Directory Link': row['D'] || '',
            'Business Name': row['H'] || '',
            'Category 1': 'Shop Local',
            'Sub category 1': 'Essential Business',
            'About': row['L'] || '',
            'Country': 'US',
            'Email': row['J'] || '',
            'Website': '',
            'Instagram username': '',
            'Facebook username': '',
            'Twitter username': '',
            'YouTube video link': ''
        };

        // Handle the phone number formatting, removing any non-digit characters
        correctedRow['Phone'] = (row['G'] || '').replace(/\D/g, '');

        // Process the full address from column M, if it exists
        if (row['M']) {
            let fullAddressParts = row['M'].split(',').map(part => part.trim());

            // Assign street address, which is typically the first part
            correctedRow['Address'] = fullAddressParts[0] || '';

            // Initialize variables for additional address components
            let suiteOrOfficeIndex = -1;

            // Identify suite or office number part and city
            fullAddressParts.forEach((part, i) => {
                if (part.toLowerCase().includes('suite') || part.toLowerCase().includes('office')) {
                    suiteOrOfficeIndex = i;
                }
            });

            // Assign suite or office number, city, state, and zip
            correctedRow['Address line 2'] = suiteOrOfficeIndex !== -1 ? fullAddressParts[suiteOrOfficeIndex] : '';
            correctedRow['City'] = suiteOrOfficeIndex !== -1 && fullAddressParts[suiteOrOfficeIndex + 1] ? fullAddressParts[suiteOrOfficeIndex + 1] : '';
            correctedRow['State'] = fullAddressParts.length > 2 ? fullAddressParts[fullAddressParts.length - 2] : '';
            correctedRow['Zip'] = fullAddressParts.length > 2 ? fullAddressParts[fullAddressParts.length - 1] : '';

            // Remove any web links from the address fields
            ['Address', 'Address line 2', 'City', 'State', 'Zip'].forEach(field => {
                if (correctedRow[field] && correctedRow[field].match(/http[s]?:\/\//)) {
                    correctedRow[field] = ''; // Clear the field if it contains a web link
                }
            });
        }

        return correctedRow;
    });
}
        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            var url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'corrected_addresses.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
