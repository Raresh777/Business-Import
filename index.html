
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input[type="file"] {
            margin-top: 20px;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>CSV Address Formatter</h1>
    <input type="file" id="csvFile" accept=".csv">
    <button id="processBtn">Process CSV</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
            return data.map((row, index) => {
                if (index === 0) {
                    return ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link'];
                }

                const businessName = row[7]; // Business Name from column H
                const about = row[11]; // About from column L
                const fullAddress = row[12]; // Full address from column M
                let [street, addressLine2, city, state, zip] = fullAddress.split(',').map(part => part.trim());

                // Formatting phone number (remove dashes and spaces)
                let phone = row[5].replace(/[\s-]/g, '');

                // Determine the country based on the address
                let country = 'US'; // Default to 'US' or implement logic to determine based on address

                // Reconstruct the row with the correct format
                return [row[0], businessName, 'Shop Local', 'Essential Business', about, street, addressLine2, city, state, zip, phone, country, row[6], row[8], row[9], row[10], row[13], row[14]];
            });
        }

        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement("a");
            var url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "corrected_addresses.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
