<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Importer</title>
    <style>
       body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: url('https://i.imgur.com/AzPlM3K.png') no-repeat center center fixed;
    background-size: cover;
    color: white;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}
        .container {
    position: relative;
    width: 100%; /* Full width */
    height: 100vh; /* Full viewport height */
    display: flex;
    justify-content: space-around; /* Spreads out the buttons evenly */
    align-items: center; /* Vertically center the buttons */
}

.button-container {
    position: relative; /* Relative to the container */
}

.input-file-trigger, .styled-button {
    background: transparent;
    color: transparent; /* Text is transparent until hovered */
    border: 2px solid transparent; /* Border is transparent until hovered */
    padding: 10px 20px;
    margin: 0 20px; /* Add margin to space out buttons if needed */
    cursor: pointer;
    transition: all 0.3s ease;
}

.input-file-trigger:hover, .styled-button:hover {
    color: white; /* Text color on hover */
    background-color: rgba(255, 255, 255, 0.1); /* Button background on hover */
    border-color: white; /* Border color on hover */
}

.input-file {
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    z-index: -1;
}

.input-file-trigger {
    font-size: 16px; /* Adjust size as needed */
    display: inline-block;
    text-align: center;
}
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
    <!-- Left side button for selecting CSV file -->
    <div class="button-container left">
        <label class="input-file-trigger" for="csvFile">Select CSV File</label>
        <input type="file" id="csvFile" class="input-file" accept=".csv">
    </div>

    <!-- Placeholder for the tree image, if it's in the HTML -->

    <!-- Right side button for processing the CSV -->
    <div class="button-container right">
        <button id="processBtn" class="styled-button">Process CSV</button>
    </div>
</div>

    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedXLSX(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function extractStreet(address) {
            var streetRegex = /\d+\s[a-zA-Z\s]+/;
            var match = address.match(streetRegex);
            return match ? match[0] : '';
        }

        function extractSuite(address) {
            var suiteRegex = /(Suite\s\d+|Unit\s\d+)/;
            var match = address.match(suiteRegex);
            return match ? match[0] : '';
        }

        function extractCity(address) {
            var cityRegex = /[a-zA-Z\s]+(?=,\s[A-Z]{2}|\s[A-Z]{2}\s\d{5})/;
            var match = address.match(cityRegex);
            return match ? match[0] : '';
        }

        function extractState(address) {
            var stateRegex = /\b[A-Z]{2}\b/;
            var match = address.match(stateRegex);
            return match ? match[0] : '';
        }

        function extractZip(address) {
            var zipRegex = /\d{5}$/;
            var match = address.match(zipRegex);
            return match ? match[0] : '';
        }

        function correctAddresses(rows) {
            let correctedData = [];
            let headers = ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 
    'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 
    'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link',
    'image', 'bbb accredited', 'category 2', 'sub category 2', 'category 3', 'sub category 3'];
            correctedData.push(headers);

            rows.forEach((row, index) => {
                if (index === 0) return;

                let fullAddress = row[12];
                let correctedRow = new Array(headers.length).fill('');

                correctedRow[5] = extractStreet(fullAddress);
                correctedRow[6] = extractSuite(fullAddress);
                correctedRow[7] = extractCity(fullAddress);
                correctedRow[8] = extractState(fullAddress);
                correctedRow[9] = extractZip(fullAddress);

                correctedRow[0] = row[3] || ''; // Directory Link from Column D
                correctedRow[1] = row[7] || ''; // Business Name from Column H
                correctedRow[2] = 'Shop Local'; // Category 1
                correctedRow[3] = 'Essential Business'; // Sub category 1
                correctedRow[4] = row[11] || ''; // About from Column L
                correctedRow[10] = (row[6] || '').replace(/\D/g, ''); // Phone from Column G
                correctedRow[11] = 'US'; // Country
                correctedRow[12] = row[9] || ''; // Email from Column J

                correctedData.push(correctedRow);
            });

            return correctedData;
        }

        function downloadCorrectedXLSX(data) {
            var workbook = XLSX.utils.book_new();
            var worksheet = XLSX.utils.aoa_to_sheet(data);

            // Apply formatting
            worksheet['!cols'] = [{ wpx: 150 }]; // Set column width
            worksheet['!rows'] = data.map((_, index) => ({ hpx: index === 0 ? 21 : 20 })); // Set row heights

            // Freeze and bold the first row
            worksheet['!freeze'] = { xSplit: "1", ySplit: "1" };
            var range = XLSX.utils.decode_range(worksheet['!ref']);
            for(var C = range.s.c; C <= range.e.c; ++C) {
                var address = XLSX.utils.encode_col(C) + "1"; // Get cell address
                if(!worksheet[address]) continue;
                worksheet[address].s = { font: { bold: true } };
            }

            XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");
            XLSX.writeFile(workbook, 'corrected_addresses.xlsx');
        }
    </script>
</body>
</html>
