<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2, #6e45e2, #88d3ce);
            color: white;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        h1 {
            text-align: center;
            color: #fff;
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background: linear-gradient(to right, #6e45e2, #88d3ce);
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        button:hover {
            background: linear-gradient(to right, #88d3ce, #6e45e2);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CSV Address Formatter</h1>
        <input type="file" id="csvFile" accept=".csv">
        <button id="processBtn">Process CSV</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
    // Assuming data is an array of objects where each object is a row from the CSV
    return data.map(row => {
        // Initialize the object that will hold the corrected row data
        let correctedRow = {};

        // Populate the corrected row with data from the "wrong" sheet
        correctedRow['Directory Link'] = row['D']; // Assumes 'D' is the key for the Directory Link column in your data
        correctedRow['Business Name'] = row['H']; // Assumes 'H' is the key for the Business Name column
        correctedRow['Category 1'] = 'Shop Local';
        correctedRow['Sub category 1'] = 'Essential Business';
        correctedRow['About'] = row['L']; // Assumes 'L' is the key for the About column
        correctedRow['Country'] = 'US';
        correctedRow['Email'] = row['J']; // Assumes 'J' is the key for the Email column

        // Handle the address parsing
        let fullAddress = row['M']; // Assumes 'M' is the key for the Address column
        if (fullAddress) {
            // Use a regular expression to detect and ignore web links
            if (!fullAddress.match(/http[s]?:\/\//)) {
                let addressParts = fullAddress.split(',');
                correctedRow['Address'] = addressParts[0].trim();
                correctedRow['City'] = addressParts.length > 2 ? addressParts[1].trim() : '';
                correctedRow['State'] = addressParts.length > 2 ? addressParts[addressParts.length - 2].trim() : '';
                correctedRow['Zip'] = addressParts.length > 2 ? addressParts[addressParts.length - 1].trim() : '';
                // Address line 2 should contain suite or office number if existent
                correctedRow['Address line 2'] = addressParts.length > 3 ? addressParts[1].trim() : '';
            }
        }

        // Handle the phone number formatting
        let phone = row['G']; // Assumes 'G' is the key for the Phone column
        correctedRow['Phone'] = phone.replace(/[\s-()]/g, '');

        // Leave social media fields blank
        correctedRow['Website'] = '';
        correctedRow['Instagram username'] = '';
        correctedRow['Facebook username'] = '';
        correctedRow['Twitter username'] = '';
        correctedRow['YouTube video link'] = '';

        return correctedRow;
    });
}
        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            var url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'corrected_addresses.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
