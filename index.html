
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Address Formatter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input[type="file"] {
            margin-top: 20px;
        }
        button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>CSV Address Formatter</h1>
    <input type="file" id="csvFile" accept=".csv">
    <button id="processBtn">Process CSV</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', function() {
            var fileInput = document.getElementById('csvFile');
            var file = fileInput.files[0];

            if (file) {
                Papa.parse(file, {
                    complete: function(results) {
                        var data = results.data;
                        var correctedData = correctAddresses(data);
                        downloadCorrectedCSV(correctedData);
                    }
                });
            } else {
                alert('Please select a CSV file to process.');
            }
        });

        function correctAddresses(data) {
            return data.map((row, index) => {
                if (index === 0) {
                    return ['Directory Link', 'Business Name', 'Category 1', 'Sub category 1', 'About', 'Address', 'Address line 2', 'City', 'State', 'Zip', 'Phone', 'Country', 'Email', 'Website', 'Instagram username', 'Facebook username', 'Twitter username', 'YouTube video link'];
                }

                const fullAddress = row[12];
                if (!fullAddress || fullAddress.includes('http') || fullAddress.trim() === '') {
                    return row;
                }

                const parts = fullAddress.split(',').map(part => part.trim());
                let [street, suite, city, state, zip] = ['', '', '', '', ''];

                if (parts.length > 0) street = parts[0];
                if (parts.length > 1) suite = parts[1].includes('suite') ? parts[1] : '';
                if (parts.length > 2) city = parts[2];
                if (parts.length > 3) state = parts[3];
                if (parts.length > 4) zip = parts[4];

                return [row[0], row[1], row[2], row[3], row[4], street, suite, city, state, zip, row[6], row[7], row[8], row[9], row[10], row[11], row[13], row[14]];
            });
        }

        function downloadCorrectedCSV(data) {
            var csv = Papa.unparse(data);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement("a");
            var url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "corrected_addresses.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
